require_relative "solution.rb"

explode_test_strs = [
  ["[[[[[9,8],1],2],3],4]", "[[[[0,9],2],3],4]"],
  ["[7,[6,[5,[4,[3,2]]]]]", "[7,[6,[5,[7,0]]]]"],
  ["[[6,[5,[4,[3,2]]]],1]", "[[6,[5,[7,0]]],3]"],
  ["[[3,[2,[1,[7,3]]]],[6,[5,[4,[3,2]]]]]", "[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]"],
  ["[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]", "[[3,[2,[8,0]]],[9,[5,[7,0]]]]"],
  ["[[[[[9,18],1],2],3],4]", "[[[[0,19],2],3],4]"],
  ["[[[[12,12],[6,14]],[[15,0],[17,[8,1]]]],[2,9]]", "[[[[12,12],[6,14]],[[15,0],[25,0]]],[3,9]]"]
]

explode_test_strs.each { |start, expected| test("EXPLODE: " + start, reduce(start, 1, 0), expected) }

split_test_strs = [
  ["[[[[0,7],4],[15,[0,13]]],[1,1]]", "[[[[0,7],4],[[7,8],[0,13]]],[1,1]]"],
  ["[[[[0,7],4],[[7,8],[0,13]]],[1,1]]", "[[[[0,7],4],[[7,8],[0,[6,7]]]],[1,1]]"]
]

split_test_strs.each { |start, expected| test("SPLIT: " + start, reduce(start, 1, 0), expected) }

addition_test_str = "[[[[[4,3],4],4],[7,[[8,4],9]]],[1,1]]"
addition_test_steps = %w[
  [[[[0,7],4],[7,[[8,4],9]]],[1,1]]
  [[[[0,7],4],[15,[0,13]]],[1,1]]
  [[[[0,7],4],[[7,8],[0,13]]],[1,1]]
  [[[[0,7],4],[[7,8],[0,[6,7]]]],[1,1]]
  [[[[0,7],4],[[7,8],[6,0]]],[8,1]]
]

test_str = addition_test_str.dup
addition_test_steps.each_with_index do |expected, i|
  test_str = reduce(test_str, 1, 0)

  test("ADDITION STEP #{i + 1}", test_str, expected)
end

test("ADDITION TOTAL", reduce(addition_test_str), addition_test_steps.last)

step_groups = [
  [
    "[[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]]",
    "[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]",
    "[[[[4,0],[5,4]],[[7,7],[6,0]]],[[8,[7,7]],[[7,9],[5,0]]]]",
  ],
  [  
    "[[[[4,0],[5,4]],[[7,7],[6,0]]],[[8,[7,7]],[[7,9],[5,0]]]]",
    "[[2,[[0,8],[3,4]]],[[[6,7],1],[7,[1,6]]]]",
    "[[[[6,7],[6,7]],[[7,7],[0,7]]],[[[8,7],[7,7]],[[8,8],[8,0]]]]",
  ],
  [ 
    "[[[[6,7],[6,7]],[[7,7],[0,7]]],[[[8,7],[7,7]],[[8,8],[8,0]]]]",
    "[[[[2,4],7],[6,[0,5]]],[[[6,8],[2,8]],[[2,1],[4,5]]]]",
    "[[[[7,0],[7,7]],[[7,7],[7,8]]],[[[7,7],[8,8]],[[7,7],[8,7]]]]",
  ],
  [  
    "[[[[7,0],[7,7]],[[7,7],[7,8]]],[[[7,7],[8,8]],[[7,7],[8,7]]]]",
    "[7,[5,[[3,8],[1,4]]]]",
    "[[[[7,7],[7,8]],[[9,5],[8,7]]],[[[6,8],[0,8]],[[9,9],[9,0]]]]",
  ],
  [  
    "[[[[7,7],[7,8]],[[9,5],[8,7]]],[[[6,8],[0,8]],[[9,9],[9,0]]]]",
    "[[2,[2,2]],[8,[8,1]]]",
    "[[[[6,6],[6,6]],[[6,0],[6,7]]],[[[7,7],[8,9]],[8,[8,1]]]]",
  ],
  [  
    "[[[[6,6],[6,6]],[[6,0],[6,7]]],[[[7,7],[8,9]],[8,[8,1]]]]",
    "[2,9]",
    "[[[[6,6],[7,7]],[[0,7],[7,7]]],[[[5,5],[5,6]],9]]",
  ],
  [ 
    "[[[[6,6],[7,7]],[[0,7],[7,7]]],[[[5,5],[5,6]],9]]",
    "[1,[[[9,3],9],[[9,0],[0,7]]]]",
    "[[[[7,8],[6,7]],[[6,8],[0,8]]],[[[7,7],[5,0]],[[5,5],[5,6]]]]",
  ],
  [  
    "[[[[7,8],[6,7]],[[6,8],[0,8]]],[[[7,7],[5,0]],[[5,5],[5,6]]]]",
    "[[[5,[7,4]],7],1]",
    "[[[[7,7],[7,7]],[[8,7],[8,7]]],[[[7,0],[7,7]],9]]",
  ],
  [  
    "[[[[7,7],[7,7]],[[8,7],[8,7]]],[[[7,0],[7,7]],9]]",
    "[[[[4,2],2],6],[8,7]]",
    "[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]",
  ]
]

step_groups.each do |group|
  addend1, addend2, expected = group

  test(addend1 + " + " + addend2, add(addend1, addend2), expected)
end

full_test_strs = %w[
  [[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]]
  [7,[[[3,7],[4,3]],[[6,3],[8,8]]]]
  [[2,[[0,8],[3,4]]],[[[6,7],1],[7,[1,6]]]]
  [[[[2,4],7],[6,[0,5]]],[[[6,8],[2,8]],[[2,1],[4,5]]]]
  [7,[5,[[3,8],[1,4]]]]
  [[2,[2,2]],[8,[8,1]]]
  [2,9]
  [1,[[[9,3],9],[[9,0],[0,7]]]]
  [[[5,[7,4]],7],1]
  [[[[4,2],2],6],[8,7]]
]
expected_full_test_result = "[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]"

test("FULL TEST", part_1_solution(full_test_strs, printable: false, return_sum: true), expected_full_test_result)

final_example = %w[
  [[[0,[5,8]],[[1,7],[9,6]]],[[4,[1,2]],[[1,4],2]]]
  [[[5,[2,8]],4],[5,[[9,9],0]]]
  [6,[[[6,2],[5,6]],[[7,6],[4,7]]]]
  [[[6,[0,7]],[0,9]],[4,[9,[9,0]]]]
  [[[7,[6,4]],[3,[1,3]]],[[[5,5],1],9]]
  [[6,[[7,3],[3,2]]],[[[3,8],[5,7]],4]]
  [[[[5,4],[7,7]],8],[[8,3],8]]
  [[9,3],[[9,9],[6,[4,9]]]]
  [[2,[[7,7],7]],[[5,8],[[9,3],[0,2]]]]
  [[[[5,2],5],[8,[3,7]]],[[5,[7,5]],[4,4]]]
]
expected_final_result = "[[[[6,6],[7,6]],[[7,7],[7,0]]],[[[7,7],[7,7]],[[7,8],[9,9]]]]"

test("FINAL PART 1 TEST: SUM", part_1_solution(final_example, printable: false, return_sum: true), expected_final_result)
test("FINAL PART 1 TEST: MAGNITUDE", part_1_solution(final_example, printable: false), 4140)